<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Chest Cancer Classification</title>
    <link rel="shortcut icon" href="data:image/png;base64,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" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Modern color scheme */
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --success-color: #059669;
            --background-color: #f8fafc;
            --card-background: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            color: var(--text-primary);
            min-height: 100vh;
        }

        .main {
            background: var(--card-background);
            border-radius: 20px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            margin: 2rem auto;
            padding: 2rem;
            max-width: 1200px;
        }

        .iupload h3 {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 2rem;
            text-align: center;
        }

        /* Modern card design */
        .image-part {
            border-radius: 12px;
            border: 2px solid var(--border-color);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            background: var(--background-color);
        }

        .image-part:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
        }

        .img-part {
            height: 300px;
            width: 300px;
            margin: 0px auto;
        }

        .image-part {
            height: 300px;
            width: 300px;
            position: relative;
            overflow: hidden;
        }

        .image-part img {
            position: absolute;
            height: 300px;
            width: 300px;
            display: none;
            padding: 5px;
            border-radius: 8px;
        }

        .image-part #video {
            display: block;
            height: 300px;
            width: 300px;
            padding: 5px;
            border-radius: 8px;
        }

        /* Prediction result styling */
        .prediction-result {
            background: linear-gradient(135deg, var(--success-color), #047857);
            color: white;
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
            margin-top: 2rem;
            min-height: 200px;
            max-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .prediction-text {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            line-height: 1.2;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            max-width: 100%;
        }

        .prediction-label {
            font-size: 1rem;
            font-weight: 500;
            margin-top: 0.5rem;
            opacity: 0.9;
            line-height: 1.3;
        }

        .prediction-content {
            width: 100%;
            padding: 1rem;
        }

        #send {
            cursor: pointer;
        }

        .btn-part {
            width: 325px;
            margin-top: 1rem;
        }

        /* Modern buttons */
        .btn {
            border-radius: 8px;
            font-weight: 600;
            padding: 12px 24px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #047857);
            color: white;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        /* Form controls */
        textarea,
        select,
        .form-control,
        .custom-select,
        input[type="text"],
        input[type="url"],
        .uneditable-input {
            border: 1px solid var(--border-color);
            outline: 0 !important;
            border-radius: 8px;
            box-shadow: none;
            -webkit-box-shadow: none;
            -moz-box-shadow: none;
            transition: all 0.3s ease;
        }

        textarea:focus,
        select:focus,
        .form-control:focus,
        .custom-select:focus,
        input[type="text"]:focus,
        .uneditable-input:focus {
            border: 2px solid var(--primary-color);
            outline: 0 !important;
            border-radius: 8px;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* Loading animation improvement */
        #loading {
            position: fixed;
            left: 0px;
            top: 0px;
            width: 100%;
            height: 100%;
            z-index: 9999999999;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            left: 50%;
            margin-left: -4em;
            display: block;
            animation: spin 1s linear infinite;
        }

        .loader,
        .loader:after {
            display: block;
            position: absolute;
            top: 50%;
            margin-top: -4.05em;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        /* Alert styling */
        .alert {
            border-radius: 8px;
            border: none;
            font-weight: 500;
        }

        .alert-info {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            color: #1e40af;
        }

        .alert-success {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            color: #065f46;
        }

        .alert-warning {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            color: #92400e;
        }

        /* Section headers */
        .section-header {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            text-align: center;
        }

        /* Upload area styling */
        .upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            background: var(--background-color);
        }

        .upload-area:hover {
            border-color: var(--primary-color);
            background: rgba(37, 99, 235, 0.05);
        }

        /* Responsive improvements */
        @media (max-width: 768px) {
            .main {
                margin: 1rem;
                padding: 1rem;
            }
            
            .iupload h3 {
                font-size: 2rem;
            }
            
            .img-part {
                width: 100%;
                max-width: 300px;
            }
            
            .image-part {
                width: 100%;
                max-width: 300px;
            }

            .prediction-text {
                font-size: 1.5rem;
            }
            
            .prediction-label {
                font-size: 0.9rem;
            }
            
            .prediction-result {
                min-height: 150px;
                max-height: 200px;
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="main container">
        <section class="iupload">
            <h3>Non-Small Cell Lung Cancer Classification</h3>
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="upload-section">
                                <h5 class="section-header">Upload CT Scan Image</h5>
                                <div class="img-part">
                                    <div class="image-part">
                                        <video autoplay id="video" poster="https://img.freepik.com/free-vector/group-young-people-posing-photo_52683-18824.jpg?size=338&ext=jpg"></video>
                                        <img src="" id="photo">
                                        <canvas style="display:none;" id="canvas"></canvas>
                                    </div>
                                </div>
                                <div class="btn-part">
                                    <form id="upload-data" class="">
                                        <div class="input-group mt-3 row">
                                            <button type="button" class="btn btn-primary col-md-5 col-xs-5 ml-3 mr-4" id="uload">
                                                <i class="fas fa-upload mr-2"></i>Upload
                                            </button>
                                            <button id="send" type="button" class="btn btn-success col-md-5 col-xs-5">
                                                <i class="fas fa-search mr-2"></i>Predict
                                            </button>
                                        </div>
                                        <input type="hidden" class="form-control mr-2" id="url" placeholder="Enter REST Api url..." value="../predict"/>
                                        <input name="upload" type="file" id="fileinput" style="position:absolute;top:-500px;"/>
                                    </form>
                                </div>
                                
                                <!-- Status alerts -->
                                <div class="alert alert-info mt-3" id="upload-status">
                                    <i class="fas fa-info-circle mr-2"></i> Please upload a chest CT scan image for classification
                                </div>
                                <div class="alert alert-success mt-3" id="success-status" style="display: none;">
                                    <i class="fas fa-check-circle mr-2"></i> Image uploaded successfully! Click Predict to analyze.
                                </div>
                                <div class="alert alert-warning mt-3" id="error-status" style="display: none;">
                                    <i class="fas fa-exclamation-triangle mr-2"></i> <span id="error-message"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h5 class="section-header">Prediction Result</h5>
                            <div class="prediction-result" id="prediction-display">
                                <div class="prediction-content">
                                    <p class="prediction-text">Upload an image to see prediction</p>
                                <p class="prediction-label">Chest CT Scan Image Classification</p>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
        </section>
    </div>

    <div id="loading">
        <div class="loader"></div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <script>
        var mybtn = document.getElementById('startbtn');
        var myvideo = document.getElementById('video');
        var mycanvas = document.getElementById('canvas');
        var myphoto = document.getElementById('photo');
        var base_data = "";

        function sendRequest(base64Data) {
            var type = "json";
            if (base64Data != "" || base64Data != null) {
                if (type == "imgtobase") {
                    $("#prediction-display").html("<div class='prediction-content'><p class='prediction-text'>Base64 Data</p><p class='prediction-label'>Image converted to base64</p></div>");
                } else if (type == "basetoimg") {
                    var imageData = $("#imgstring").val();
                    $("#prediction-display").html("<div class='prediction-content'><p class='prediction-text'>Image Display</p><p class='prediction-label'>Base64 converted to image</p></div>");
                } else {
                    var url = $("#url").val();
                    $("#loading").show();
                    $.ajax({
                        url: url,
                        type: "post",
                        cache: false,
                        async: true,
                        crossDomain: true,
                        headers: {
                            'Content-Type': 'application/json',
                            'Access-Control-Allow-Origin': '*'
                        },
                        data: JSON.stringify({ image: base64Data }),
                        success: function(res) {
                            $("#loading").hide();
                            console.log("Prediction Response:", res);

                            // Display the predicted class in a nice format
                            if (res.predicted_class) {
                                var predictionText = res.predicted_class;
                                // Clean up the prediction text for better display
                                predictionText = predictionText.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                                
                                $("#prediction-display").html(`
                                    <div class="prediction-content">
                                        <p class="prediction-text">${predictionText}</p>
                                        <p class="prediction-label">Predicted Classification</p>
                                    </div>
                                `);
                            } else {
                                $("#prediction-display").html(`
                                    <div class="prediction-content">
                                        <p class="prediction-text">No Prediction</p>
                                        <p class="prediction-label">Unable to classify image</p>
                                    </div>
                                `);
                            }
                        },
                        error: function(xhr, status, error) {
                            $("#loading").hide();
                            $("#error-message").text("Error: " + error);
                            $("#error-status").show();
                            $("#prediction-display").html(`
                                <div class="prediction-content">
                                    <p class="prediction-text">Error</p>
                                    <p class="prediction-label">Failed to get prediction</p>
                                </div>
                            `);
                        }
                    });
                }
            }
        }

        $(document).ready(function() {
            $("#loading").hide();
            $("#error-status").hide();

            $('#send').click(function(evt) {
                if (base_data === "") {
                    $("#error-message").text("Please upload an image first");
                    $("#error-status").show();
                    return;
                }
                sendRequest(base_data);
            });

            $('#uload').click(function(evt) {
                $('#fileinput').focus().trigger('click');
            });

            $("#fileinput").change(function() {
                if (this.files && this.files[0]) {
                    var file = this.files[0];
                    
                    // Validate file type
                    if (!file.type.match('image.*')) {
                        $("#error-message").text("Please select an image file");
                        $("#error-status").show();
                        return;
                    }
                    
                    // Validate file size (max 10MB)
                    if (file.size > 10 * 1024 * 1024) {
                        $("#error-message").text("File size too large. Please select an image under 10MB");
                        $("#error-status").show();
                        return;
                    }

                    var reader = new FileReader();
                    reader.onload = function(e) {
                        var url = e.target.result;
                        var img = new Image();
                        img.crossOrigin = 'Anonymous';
                        img.onload = function() {
                            var canvas = document.createElement('CANVAS');
                            var ctx = canvas.getContext('2d');
                            canvas.height = this.height;
                            canvas.width = this.width;
                            ctx.drawImage(this, 0, 0);
                            base_data = canvas.toDataURL('image/jpeg', 1.0).replace(/^data:image.+;base64,/, '');
                            canvas = null;
                        };
                        img.src = url;
                        $('#photo').attr('src', url);
                        $('#photo').show();
                        $('#video').hide();
                        
                        // Show success message
                        $("#success-status").show();
                        $("#error-status").hide();
                        $("#upload-status").hide();
                    }
                    reader.readAsDataURL(this.files[0]);
                }
            });
        });
    </script>
</body>
</html>